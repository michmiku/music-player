{"ast":null,"code":"import _toConsumableArray from\"C:\\\\Users\\\\micha\\\\Desktop\\\\port\\\\portfolio\\\\portfolio\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"C:\\\\Users\\\\micha\\\\Desktop\\\\port\\\\portfolio\\\\portfolio\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useState,useContext,useEffect,useRef}from\"react\";import{AuthenticatedUser}from\"../contexts/AuthenticatedUser.js\";import{Link}from'react-router-dom';import axios from'axios';import Player from\"./Player.js\";import Sidebar from\"./Sidebar.js\";import MusicList from\"./MusicList.js\";import Settings from\"../Settings.json\";var Music=function Music(){var _useState=useState({music:[]}),_useState2=_slicedToArray(_useState,2),musicList=_useState2[0],setMusicList=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),src=_useState4[0],setSrc=_useState4[1];var _useState5=useState({playing:false}),_useState6=_slicedToArray(_useState5,2),isPlaying=_useState6[0],setIsPlaying=_useState6[1];var _useState7=useState({duration:'',rawDuration:''}),_useState8=_slicedToArray(_useState7,2),duration=_useState8[0],setDuration=_useState8[1];var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),currentTime=_useState10[0],setCurrentTime=_useState10[1];var _useState11=useState(),_useState12=_slicedToArray(_useState11,2),currentId=_useState12[0],setCurrentId=_useState12[1];var _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),currentPlaylist=_useState14[0],setCurrentPlaylist=_useState14[1];var _useState15=useState([]),_useState16=_slicedToArray(_useState15,2),favoriteMusic=_useState16[0],setFavoriteMusic=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),myMusic=_useState18[0],setMyMusic=_useState18[1];var _useState19=useState(false),_useState20=_slicedToArray(_useState19,2),repeat=_useState20[0],setRepeat=_useState20[1];var _useState21=useState(false),_useState22=_slicedToArray(_useState21,2),random=_useState22[0],setRandom=_useState22[1];var _useState23=useState(),_useState24=_slicedToArray(_useState23,2),currentArtistPlaylist=_useState24[0],setCurrentArtistPlaylist=_useState24[1];var _useState25=useState(),_useState26=_slicedToArray(_useState25,2),currentArtist=_useState26[0],setCurrentArtist=_useState26[1];var _useContext=useContext(AuthenticatedUser),authUser=_useContext.authUser;var player=useRef(null);useEffect(function(){axios.get(Settings.server+'music/getlist').then(function(res){setMusicList({music:res.data});}).catch(function(err){return console.log(err);});axios.post(Settings.server+'music/favorite',authUser).then(function(res){var temp=[];res.data.map(function(_ref){var title=_ref.title;temp=[].concat(_toConsumableArray(temp),[title]);setFavoriteMusic(temp);});}).catch(function(err){return console.log(err);});},[]);useEffect(function(){if(src!==''){player.current.load();player.current.play();}},[src]);var handleTitleClick=function handleTitleClick(file,key,duration,rawDuration){setSrc(Settings.server+'music/'+file);setIsPlaying({playing:true});setCurrentId(key);setDuration({duration:duration,rawDuration:rawDuration});setCurrentArtist(currentArtistPlaylist);};var _handlePlay=function handlePlay(file,key,duration,rawDuration){if(src===''&&file===undefined){}else if(src===Settings.server+'music/'+file||file===undefined){setIsPlaying({playing:true});player.current.play();}else{setSrc(Settings.server+'music/'+file);setIsPlaying({playing:true});setCurrentId(key);setDuration({duration:duration,rawDuration:rawDuration});setCurrentArtist(currentArtistPlaylist);}};var _handlePause=function handlePause(){setIsPlaying({playing:false});player.current.pause();};var handleProgress=function handleProgress(){setCurrentTime(player.current.currentTime);};var handleEnd=function handleEnd(e){var id=currentId;if(currentPlaylist.length<2&&!random&&!repeat){setCurrentTime(0);setSrc('');setCurrentId(null);setDuration({duration:'',rawDuration:0});setIsPlaying({playing:false});player.current.load();player.current.play();}else if(random){if(currentPlaylist.length<2){setCurrentTime(0);player.current.load();player.current.play();}else{while(id===currentId){id=Math.floor(Math.random()*currentPlaylist.length);}if(currentArtist===currentArtistPlaylist||myMusic&&currentArtist===currentArtistPlaylist){setSrc(Settings.server+'music/'+currentPlaylist[id].file);setCurrentId(id);setDuration({duration:currentPlaylist[id].duration,rawDuration:currentPlaylist[id].rawDuration});setIsPlaying({playing:true});}}}else if(repeat){setCurrentTime(0);player.current.load();player.current.play();}else if(id<currentPlaylist.length-1&&currentArtist===currentArtistPlaylist||id<currentPlaylist.length-1&&myMusic&&currentArtist===currentArtistPlaylist){setSrc(Settings.server+'music/'+currentPlaylist[id+1].file);setCurrentId(id+1);setDuration({duration:currentPlaylist[id+1].duration,rawDuration:currentPlaylist[id+1].rawDuration});setIsPlaying({playing:true});}};var handleNewArtist=function handleNewArtist(artist){var temp=musicList.music.filter(function(song){return song.artist===artist;});setCurrentPlaylist(temp);setMyMusic(false);setCurrentArtistPlaylist(artist);};return/*#__PURE__*/React.createElement(\"div\",null,authUser.username!==''?/*#__PURE__*/React.createElement(\"div\",{className:\"cont\"},/*#__PURE__*/React.createElement(Sidebar,{musicList:musicList,handleNewArtist:handleNewArtist,myMusic:myMusic,setMyMusic:setMyMusic,setCurrentArtistPlaylist:setCurrentArtistPlaylist,currentArtistPlaylist:currentArtistPlaylist}),/*#__PURE__*/React.createElement(MusicList,{musicList:musicList,handleTitleClick:handleTitleClick,handlePlay:_handlePlay,handlePause:_handlePause,isPlaying:isPlaying,src:src,authUser:authUser,favoriteMusic:favoriteMusic,setFavoriteMusic:setFavoriteMusic,currentPlaylist:currentPlaylist,myMusic:myMusic,setCurrentPlaylist:setCurrentPlaylist}),/*#__PURE__*/React.createElement(Player,{isPlaying:isPlaying,handlePlay:function handlePlay(){_handlePlay();},handlePause:function handlePause(){_handlePause();},player:player,src:src,setSrc:setSrc,duration:duration,currentTime:currentTime,musicList:currentPlaylist,currentId:currentId,setCurrentId:setCurrentId,setDuration:setDuration,setIsPlaying:setIsPlaying,myMusic:myMusic,repeat:repeat,setRepeat:setRepeat,random:random,setRandom:setRandom,currentArtistPlaylist:currentArtistPlaylist,currentArtist:currentArtist}),/*#__PURE__*/React.createElement(\"audio\",{ref:player,onTimeUpdate:function onTimeUpdate(){return handleProgress();},onEnded:function onEnded(){handleEnd();}},/*#__PURE__*/React.createElement(\"source\",{src:src}))):/*#__PURE__*/React.createElement(\"div\",{className:\"card-body\"},/*#__PURE__*/React.createElement(\"h5\",{className:\"card-title\"},\"You are not logged in!\"),/*#__PURE__*/React.createElement(\"p\",{className:\"card-text\"},\"In order to browse and listen to music you need to either login to your account or create a new one.\"),/*#__PURE__*/React.createElement(Link,{to:\"/login\",className:\"btn btn-primary mr-3 \"},\"Login\"),/*#__PURE__*/React.createElement(Link,{to:\"/register\",className:\"btn btn-primary \"},\"Register\")));};export default Music;","map":{"version":3,"sources":["C:/Users/micha/Desktop/port/portfolio/portfolio/src/components/Music.js"],"names":["React","useState","useContext","useEffect","useRef","AuthenticatedUser","Link","axios","Player","Sidebar","MusicList","Settings","Music","music","musicList","setMusicList","src","setSrc","playing","isPlaying","setIsPlaying","duration","rawDuration","setDuration","currentTime","setCurrentTime","currentId","setCurrentId","currentPlaylist","setCurrentPlaylist","favoriteMusic","setFavoriteMusic","myMusic","setMyMusic","repeat","setRepeat","random","setRandom","currentArtistPlaylist","setCurrentArtistPlaylist","currentArtist","setCurrentArtist","authUser","player","get","server","then","res","data","catch","err","console","log","post","temp","map","title","current","load","play","handleTitleClick","file","key","handlePlay","undefined","handlePause","pause","handleProgress","handleEnd","e","id","length","Math","floor","handleNewArtist","artist","filter","song","username"],"mappings":"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","sourcesContent":["import React, { useState, useContext, useEffect, useRef } from \"react\";\r\nimport { AuthenticatedUser } from \"../contexts/AuthenticatedUser.js\"\r\nimport { Link } from 'react-router-dom'\r\nimport axios from 'axios'\r\nimport Player from \"./Player.js\";\r\nimport Sidebar from \"./Sidebar.js\";\r\nimport MusicList from \"./MusicList.js\";\r\nimport Settings from \"../Settings.json\"\r\n\r\nconst Music = () => {\r\n    const [musicList, setMusicList] = useState({ music: [] })\r\n    const [src, setSrc] = useState('')\r\n    const [isPlaying, setIsPlaying] = useState({ playing: false })\r\n    const [duration, setDuration] = useState({ duration: '', rawDuration: '' })\r\n    const [currentTime, setCurrentTime] = useState()\r\n    const [currentId, setCurrentId] = useState()\r\n    const [currentPlaylist, setCurrentPlaylist] = useState([])\r\n    const [favoriteMusic, setFavoriteMusic] = useState([])\r\n    const [myMusic, setMyMusic] = useState(false)\r\n    const [repeat, setRepeat] = useState(false)\r\n    const [random, setRandom] = useState(false)\r\n    const [currentArtistPlaylist, setCurrentArtistPlaylist] = useState()\r\n    const [currentArtist, setCurrentArtist] = useState()\r\n\r\n    const { authUser } = useContext(AuthenticatedUser)\r\n\r\n    const player = useRef(null)\r\n\r\n    useEffect(() => {\r\n        axios.get(Settings.server + 'music/getlist')\r\n            .then(res => {\r\n                setMusicList({ music: res.data })\r\n            })\r\n            .catch(err => console.log(err));\r\n        axios.post(Settings.server + 'music/favorite', authUser)\r\n            .then(res => {\r\n                let temp = []\r\n                res.data.map(({ title }) => {\r\n                    temp = [...temp, title]\r\n                    setFavoriteMusic(temp)\r\n                })\r\n            })\r\n            .catch(err => console.log(err));\r\n    }, [])\r\n    useEffect(() => {\r\n        if (src !== '') {\r\n            player.current.load()\r\n            player.current.play()\r\n        }\r\n\r\n    }, [src])\r\n\r\n    const handleTitleClick = (file, key, duration, rawDuration) => {\r\n        setSrc(Settings.server + 'music/' + file)\r\n        setIsPlaying({ playing: true })\r\n        setCurrentId(key)\r\n        setDuration({ duration: duration, rawDuration: rawDuration })\r\n        setCurrentArtist(currentArtistPlaylist)\r\n    }\r\n    const handlePlay = (file, key, duration, rawDuration) => {\r\n        if (src === '' && file === undefined) { }\r\n        else if ((src === Settings.server + 'music/' + file) || file === undefined) {\r\n            setIsPlaying({ playing: true })\r\n            player.current.play()\r\n        }\r\n        else {\r\n            setSrc(Settings.server + 'music/' + file)\r\n            setIsPlaying({ playing: true })\r\n            setCurrentId(key)\r\n            setDuration({ duration: duration, rawDuration: rawDuration })\r\n            setCurrentArtist(currentArtistPlaylist)\r\n        }\r\n    }\r\n    const handlePause = () => {\r\n        setIsPlaying({ playing: false })\r\n        player.current.pause()\r\n    }\r\n    const handleProgress = () => {\r\n        setCurrentTime(player.current.currentTime)\r\n    }\r\n    const handleEnd = (e) => {\r\n        let id = currentId\r\n        if (currentPlaylist.length < 2 && !random && !repeat) {\r\n            setCurrentTime(0)\r\n            setSrc('')\r\n            setCurrentId(null)\r\n            setDuration({ duration: '', rawDuration: 0 })\r\n            setIsPlaying({ playing: false })\r\n            player.current.load()\r\n            player.current.play()\r\n        }\r\n        else if (random) {\r\n            if (currentPlaylist.length < 2) {\r\n                setCurrentTime(0)\r\n                player.current.load()\r\n                player.current.play()\r\n            }\r\n            else {\r\n                while (id === currentId) {\r\n                    id = Math.floor(Math.random() * (currentPlaylist.length))\r\n                }\r\n\r\n                if ((currentArtist === currentArtistPlaylist) || (myMusic && currentArtist === currentArtistPlaylist)) {\r\n                    setSrc(Settings.server + 'music/' + currentPlaylist[id].file)\r\n                    setCurrentId(id)\r\n                    setDuration({ duration: currentPlaylist[id].duration, rawDuration: currentPlaylist[id].rawDuration })\r\n                    setIsPlaying({ playing: true })\r\n                }\r\n            }\r\n        }\r\n        else if (repeat) {\r\n            setCurrentTime(0)\r\n            player.current.load()\r\n            player.current.play()\r\n        }\r\n        else if ((id < currentPlaylist.length - 1 && currentArtist === currentArtistPlaylist) || (id < currentPlaylist.length - 1 && myMusic && currentArtist === currentArtistPlaylist)) {\r\n            setSrc(Settings.server + 'music/' + currentPlaylist[id + 1].file)\r\n            setCurrentId(id + 1)\r\n            setDuration({ duration: currentPlaylist[id + 1].duration, rawDuration: currentPlaylist[id + 1].rawDuration })\r\n            setIsPlaying({ playing: true })\r\n        }\r\n    }\r\n    const handleNewArtist = (artist) => {\r\n        let temp = musicList.music.filter(song => song.artist === artist)\r\n        setCurrentPlaylist(temp)\r\n        setMyMusic(false)\r\n        setCurrentArtistPlaylist(artist)\r\n    }\r\n    return (\r\n        <div>\r\n            {authUser.username !== '' ?\r\n                <div className=\"cont\">\r\n                    <Sidebar musicList={musicList} handleNewArtist={handleNewArtist} myMusic={myMusic} setMyMusic={setMyMusic} setCurrentArtistPlaylist={setCurrentArtistPlaylist} currentArtistPlaylist={currentArtistPlaylist} />\r\n                    <MusicList musicList={musicList} handleTitleClick={handleTitleClick} handlePlay={handlePlay} handlePause={handlePause} isPlaying={isPlaying} src={src} authUser={authUser} favoriteMusic={favoriteMusic} setFavoriteMusic={setFavoriteMusic} currentPlaylist={currentPlaylist} myMusic={myMusic} setCurrentPlaylist={setCurrentPlaylist} />\r\n                    <Player isPlaying={isPlaying} handlePlay={() => { handlePlay() }} handlePause={() => { handlePause() }} player={player} src={src} setSrc={setSrc} duration={duration} currentTime={currentTime} musicList={currentPlaylist} currentId={currentId} setCurrentId={setCurrentId} setDuration={setDuration} setIsPlaying={setIsPlaying} myMusic={myMusic} repeat={repeat} setRepeat={setRepeat} random={random} setRandom={setRandom} currentArtistPlaylist={currentArtistPlaylist} currentArtist={currentArtist} />\r\n                    <audio ref={player} onTimeUpdate={() => handleProgress()} onEnded={() => { handleEnd() }}>\r\n                        <source src={src} />\r\n                    </audio>\r\n                </div>\r\n\r\n                :\r\n                <div className=\"card-body\">\r\n                    <h5 className=\"card-title\">You are not logged in!</h5>\r\n                    <p className=\"card-text\">In order to browse and listen to music you need to either login to your account or create a new one.</p>\r\n                    <Link to=\"/login\" className=\"btn btn-primary mr-3 \">Login</Link>\r\n                    <Link to=\"/register\" className=\"btn btn-primary \">Register</Link>\r\n                </div>\r\n            }\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Music;\r\n\r\n"]},"metadata":{},"sourceType":"module"}