{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\micha\\\\Desktop\\\\port\\\\portfolio\\\\portfolio\\\\src\\\\components\\\\music-player\\\\Music.js\";\nimport React, { useState, useContext, useEffect, useRef } from \"react\";\nimport { AuthenticatedUser } from \"../../contexts/AuthenticatedUser.js\";\nimport { Link } from 'react-router-dom';\nimport axios from 'axios';\nimport Player from \"./Player.js\";\nimport Sidebar from \"./Sidebar.js\";\nimport MusicList from \"./MusicList.js\";\nimport Settings from \"../../Settings.json\";\n\nconst Music = () => {\n  const [musicList, setMusicList] = useState({\n    music: []\n  });\n  const [src, setSrc] = useState('');\n  const [isPlaying, setIsPlaying] = useState({\n    playing: false\n  });\n  const [duration, setDuration] = useState({\n    duration: '',\n    rawDuration: ''\n  });\n  const [currentTime, setCurrentTime] = useState();\n  const [currentId, setCurrentId] = useState();\n  const [currentPlaylist, setCurrentPlaylist] = useState([]);\n  const [favoriteMusic, setFavoriteMusic] = useState([]);\n  const [myMusic, setMyMusic] = useState(false);\n  const [repeat, setRepeat] = useState(false);\n  const [random, setRandom] = useState(false);\n  const [currentArtistPlaylist, setCurrentArtistPlaylist] = useState();\n  const [currentArtist, setCurrentArtist] = useState();\n  const {\n    authUser\n  } = useContext(AuthenticatedUser);\n  const player = useRef(null);\n  useEffect(() => {\n    axios.get(Settings.server + 'music/getlist').then(res => {\n      setMusicList({\n        music: res.data\n      });\n    }).catch(err => console.log(err));\n    axios.post(Settings.server + 'music/favorite', authUser).then(res => {\n      let temp = [];\n      res.data.map(({\n        title\n      }) => {\n        temp = [...temp, title];\n        setFavoriteMusic(temp);\n      });\n    }).catch(err => console.log(err));\n  }, []);\n  useEffect(() => {\n    if (src !== '') {\n      player.current.load();\n      player.current.play();\n    }\n  }, [src]);\n\n  const handleTitleClick = (file, key, duration, rawDuration) => {\n    setSrc(Settings.server + 'music/' + file);\n    setIsPlaying({\n      playing: true\n    });\n    setCurrentId(key);\n    setDuration({\n      duration: duration,\n      rawDuration: rawDuration\n    });\n    setCurrentArtist(currentArtistPlaylist);\n  };\n\n  const handlePlay = (file, key, duration, rawDuration) => {\n    if (src === '' && file === undefined) {} else if (src === Settings.server + 'music/' + file || file === undefined) {\n      setIsPlaying({\n        playing: true\n      });\n      player.current.play();\n    } else {\n      setSrc(Settings.server + 'music/' + file);\n      setIsPlaying({\n        playing: true\n      });\n      setCurrentId(key);\n      setDuration({\n        duration: duration,\n        rawDuration: rawDuration\n      });\n      setCurrentArtist(currentArtistPlaylist);\n    }\n  };\n\n  const handlePause = () => {\n    setIsPlaying({\n      playing: false\n    });\n    player.current.pause();\n  };\n\n  const handleProgress = () => {\n    setCurrentTime(player.current.currentTime);\n  };\n\n  const handleEnd = e => {\n    let id = currentId;\n\n    if (currentPlaylist.length < 2 && !random && !repeat) {\n      setCurrentTime(0);\n      setSrc('');\n      setCurrentId(null);\n      setDuration({\n        duration: '',\n        rawDuration: 0\n      });\n      setIsPlaying({\n        playing: false\n      });\n      player.current.load();\n      player.current.play();\n    } else if (random) {\n      if (currentPlaylist.length < 2) {\n        setCurrentTime(0);\n        player.current.load();\n        player.current.play();\n      } else {\n        while (id === currentId) {\n          id = Math.floor(Math.random() * currentPlaylist.length);\n        }\n\n        if (currentArtist === currentArtistPlaylist || myMusic && currentArtist === currentArtistPlaylist) {\n          setSrc(Settings.server + 'music/' + currentPlaylist[id].file);\n          setCurrentId(id);\n          setDuration({\n            duration: currentPlaylist[id].duration,\n            rawDuration: currentPlaylist[id].rawDuration\n          });\n          setIsPlaying({\n            playing: true\n          });\n        }\n      }\n    } else if (repeat) {\n      setCurrentTime(0);\n      player.current.load();\n      player.current.play();\n    } else if (id < currentPlaylist.length - 1 && currentArtist === currentArtistPlaylist || id < currentPlaylist.length - 1 && myMusic && currentArtist === currentArtistPlaylist) {\n      setSrc(Settings.server + 'music/' + currentPlaylist[id + 1].file);\n      setCurrentId(id + 1);\n      setDuration({\n        duration: currentPlaylist[id + 1].duration,\n        rawDuration: currentPlaylist[id + 1].rawDuration\n      });\n      setIsPlaying({\n        playing: true\n      });\n    }\n  };\n\n  const handleNewArtist = artist => {\n    let temp = musicList.music.filter(song => song.artist === artist);\n    setCurrentPlaylist(temp);\n    setMyMusic(false);\n    setCurrentArtistPlaylist(artist);\n  };\n\n  return authUser.username !== '' && authUser.username !== 'null' && authUser.username !== null ? /*#__PURE__*/React.createElement(\"div\", {\n    className: \"box\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Sidebar, {\n    musicList: musicList,\n    handleNewArtist: handleNewArtist,\n    myMusic: myMusic,\n    setMyMusic: setMyMusic,\n    setCurrentArtistPlaylist: setCurrentArtistPlaylist,\n    currentArtistPlaylist: currentArtistPlaylist,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(MusicList, {\n    musicList: musicList,\n    handleTitleClick: handleTitleClick,\n    handlePlay: handlePlay,\n    handlePause: handlePause,\n    isPlaying: isPlaying,\n    src: src,\n    authUser: authUser,\n    favoriteMusic: favoriteMusic,\n    setFavoriteMusic: setFavoriteMusic,\n    currentPlaylist: currentPlaylist,\n    myMusic: myMusic,\n    setCurrentPlaylist: setCurrentPlaylist,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(Player, {\n    isPlaying: isPlaying,\n    handlePlay: () => {\n      handlePlay();\n    },\n    handlePause: () => {\n      handlePause();\n    },\n    player: player,\n    src: src,\n    setSrc: setSrc,\n    duration: duration,\n    currentTime: currentTime,\n    musicList: currentPlaylist,\n    currentId: currentId,\n    setCurrentId: setCurrentId,\n    setDuration: setDuration,\n    setIsPlaying: setIsPlaying,\n    myMusic: myMusic,\n    repeat: repeat,\n    setRepeat: setRepeat,\n    random: random,\n    setRandom: setRandom,\n    currentArtistPlaylist: currentArtistPlaylist,\n    currentArtist: currentArtist,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(\"audio\", {\n    ref: player,\n    onTimeUpdate: () => handleProgress(),\n    onEnded: () => {\n      handleEnd();\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"source\", {\n    src: src,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 21\n    }\n  }))) : /*#__PURE__*/React.createElement(\"div\", {\n    className: \"card-body\",\n    style: {\n      backgroundColor: 'rgb(82, 82, 82)',\n      color: 'rgb(201, 201, 201)'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"h1\", {\n    className: \"card-title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 17\n    }\n  }, \"You are not logged in!\"), /*#__PURE__*/React.createElement(\"h3\", {\n    className: \"card-text\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 17\n    }\n  }, \"In order to browse and listen to music you need to either login to your account or create a new one.\"), /*#__PURE__*/React.createElement(Link, {\n    to: \"/login\",\n    className: \"btn btn-dark mr-5 btn-lg\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 17\n    }\n  }, \"Login\"), /*#__PURE__*/React.createElement(Link, {\n    to: \"/register\",\n    className: \"btn btn-dark btn-lg\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 17\n    }\n  }, \"Register\"));\n};\n\nexport default Music;","map":{"version":3,"sources":["C:/Users/micha/Desktop/port/portfolio/portfolio/src/components/music-player/Music.js"],"names":["React","useState","useContext","useEffect","useRef","AuthenticatedUser","Link","axios","Player","Sidebar","MusicList","Settings","Music","musicList","setMusicList","music","src","setSrc","isPlaying","setIsPlaying","playing","duration","setDuration","rawDuration","currentTime","setCurrentTime","currentId","setCurrentId","currentPlaylist","setCurrentPlaylist","favoriteMusic","setFavoriteMusic","myMusic","setMyMusic","repeat","setRepeat","random","setRandom","currentArtistPlaylist","setCurrentArtistPlaylist","currentArtist","setCurrentArtist","authUser","player","get","server","then","res","data","catch","err","console","log","post","temp","map","title","current","load","play","handleTitleClick","file","key","handlePlay","undefined","handlePause","pause","handleProgress","handleEnd","e","id","length","Math","floor","handleNewArtist","artist","filter","song","username","backgroundColor","color"],"mappings":"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","sourcesContent":["import React, { useState, useContext, useEffect, useRef } from \"react\";\r\nimport { AuthenticatedUser } from \"../../contexts/AuthenticatedUser.js\"\r\nimport { Link } from 'react-router-dom'\r\nimport axios from 'axios'\r\nimport Player from \"./Player.js\";\r\nimport Sidebar from \"./Sidebar.js\";\r\nimport MusicList from \"./MusicList.js\";\r\nimport Settings from \"../../Settings.json\"\r\n\r\nconst Music = () => {\r\n    const [musicList, setMusicList] = useState({ music: [] })\r\n    const [src, setSrc] = useState('')\r\n    const [isPlaying, setIsPlaying] = useState({ playing: false })\r\n    const [duration, setDuration] = useState({ duration: '', rawDuration: '' })\r\n    const [currentTime, setCurrentTime] = useState()\r\n    const [currentId, setCurrentId] = useState()\r\n    const [currentPlaylist, setCurrentPlaylist] = useState([])\r\n    const [favoriteMusic, setFavoriteMusic] = useState([])\r\n    const [myMusic, setMyMusic] = useState(false)\r\n    const [repeat, setRepeat] = useState(false)\r\n    const [random, setRandom] = useState(false)\r\n    const [currentArtistPlaylist, setCurrentArtistPlaylist] = useState()\r\n    const [currentArtist, setCurrentArtist] = useState()\r\n\r\n    const { authUser } = useContext(AuthenticatedUser)\r\n\r\n    const player = useRef(null)\r\n\r\n    useEffect(() => {\r\n        axios.get(Settings.server + 'music/getlist')\r\n            .then(res => {\r\n                setMusicList({ music: res.data })\r\n            })\r\n            .catch(err => console.log(err));\r\n        axios.post(Settings.server + 'music/favorite', authUser)\r\n            .then(res => {\r\n                let temp = []\r\n                res.data.map(({ title }) => {\r\n                    temp = [...temp, title]\r\n                    setFavoriteMusic(temp)\r\n                })\r\n            })\r\n            .catch(err => console.log(err));\r\n    }, [])\r\n    useEffect(() => {\r\n        if (src !== '') {\r\n            player.current.load()\r\n            player.current.play()\r\n        }\r\n    }, [src])\r\n\r\n    const handleTitleClick = (file, key, duration, rawDuration) => {\r\n        setSrc(Settings.server + 'music/' + file)\r\n        setIsPlaying({ playing: true })\r\n        setCurrentId(key)\r\n        setDuration({ duration: duration, rawDuration: rawDuration })\r\n        setCurrentArtist(currentArtistPlaylist)\r\n    }\r\n    const handlePlay = (file, key, duration, rawDuration) => {\r\n        if (src === '' && file === undefined) { }\r\n        else if ((src === Settings.server + 'music/' + file) || file === undefined) {\r\n            setIsPlaying({ playing: true })\r\n            player.current.play()\r\n        }\r\n        else {\r\n            setSrc(Settings.server + 'music/' + file)\r\n            setIsPlaying({ playing: true })\r\n            setCurrentId(key)\r\n            setDuration({ duration: duration, rawDuration: rawDuration })\r\n            setCurrentArtist(currentArtistPlaylist)\r\n        }\r\n    }\r\n    const handlePause = () => {\r\n        setIsPlaying({ playing: false })\r\n        player.current.pause()\r\n    }\r\n    const handleProgress = () => {\r\n        setCurrentTime(player.current.currentTime)\r\n    }\r\n    const handleEnd = (e) => {\r\n        let id = currentId\r\n        if (currentPlaylist.length < 2 && !random && !repeat) {\r\n            setCurrentTime(0)\r\n            setSrc('')\r\n            setCurrentId(null)\r\n            setDuration({ duration: '', rawDuration: 0 })\r\n            setIsPlaying({ playing: false })\r\n            player.current.load()\r\n            player.current.play()\r\n        }\r\n        else if (random) {\r\n            if (currentPlaylist.length < 2) {\r\n                setCurrentTime(0)\r\n                player.current.load()\r\n                player.current.play()\r\n            }\r\n            else {\r\n                while (id === currentId) {\r\n                    id = Math.floor(Math.random() * (currentPlaylist.length))\r\n                }\r\n\r\n                if ((currentArtist === currentArtistPlaylist) || (myMusic && currentArtist === currentArtistPlaylist)) {\r\n                    setSrc(Settings.server + 'music/' + currentPlaylist[id].file)\r\n                    setCurrentId(id)\r\n                    setDuration({ duration: currentPlaylist[id].duration, rawDuration: currentPlaylist[id].rawDuration })\r\n                    setIsPlaying({ playing: true })\r\n                }\r\n            }\r\n        }\r\n        else if (repeat) {\r\n            setCurrentTime(0)\r\n            player.current.load()\r\n            player.current.play()\r\n        }\r\n        else if ((id < currentPlaylist.length - 1 && currentArtist === currentArtistPlaylist) || (id < currentPlaylist.length - 1 && myMusic && currentArtist === currentArtistPlaylist)) {\r\n            setSrc(Settings.server + 'music/' + currentPlaylist[id + 1].file)\r\n            setCurrentId(id + 1)\r\n            setDuration({ duration: currentPlaylist[id + 1].duration, rawDuration: currentPlaylist[id + 1].rawDuration })\r\n            setIsPlaying({ playing: true })\r\n        }\r\n    }\r\n    const handleNewArtist = (artist) => {\r\n        let temp = musicList.music.filter(song => song.artist === artist)\r\n        setCurrentPlaylist(temp)\r\n        setMyMusic(false)\r\n        setCurrentArtistPlaylist(artist)\r\n    }\r\n    return (\r\n        authUser.username !== '' && authUser.username !== 'null' && authUser.username !== null ?\r\n            <div className=\"box\">\r\n                <Sidebar musicList={musicList} handleNewArtist={handleNewArtist} myMusic={myMusic} setMyMusic={setMyMusic} setCurrentArtistPlaylist={setCurrentArtistPlaylist} currentArtistPlaylist={currentArtistPlaylist} />\r\n                <MusicList musicList={musicList} handleTitleClick={handleTitleClick} handlePlay={handlePlay} handlePause={handlePause} isPlaying={isPlaying} src={src} authUser={authUser} favoriteMusic={favoriteMusic} setFavoriteMusic={setFavoriteMusic} currentPlaylist={currentPlaylist} myMusic={myMusic} setCurrentPlaylist={setCurrentPlaylist} />\r\n                <Player isPlaying={isPlaying} handlePlay={() => { handlePlay() }} handlePause={() => { handlePause() }} player={player} src={src} setSrc={setSrc} duration={duration} currentTime={currentTime} musicList={currentPlaylist} currentId={currentId} setCurrentId={setCurrentId} setDuration={setDuration} setIsPlaying={setIsPlaying} myMusic={myMusic} repeat={repeat} setRepeat={setRepeat} random={random} setRandom={setRandom} currentArtistPlaylist={currentArtistPlaylist} currentArtist={currentArtist} />\r\n                <audio ref={player} onTimeUpdate={() => handleProgress()} onEnded={() => { handleEnd() }}>\r\n                    <source src={src} />\r\n                </audio>\r\n            </div>\r\n            :\r\n            <div className=\"card-body\" style={{ backgroundColor: 'rgb(82, 82, 82)', color: 'rgb(201, 201, 201)' }}>\r\n                <h1 className=\"card-title\">You are not logged in!</h1>\r\n                <h3 className=\"card-text\">In order to browse and listen to music you need to either login to your account or create a new one.</h3>\r\n                <Link to=\"/login\" className=\"btn btn-dark mr-5 btn-lg\">Login</Link>\r\n                <Link to=\"/register\" className=\"btn btn-dark btn-lg\">Register</Link>\r\n            </div>\r\n\r\n    )\r\n}\r\n\r\nexport default Music;\r\n\r\n"]},"metadata":{},"sourceType":"module"}